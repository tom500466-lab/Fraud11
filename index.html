<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全民防詐騙守護網 - 即時檢測系統</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons Components (Inline SVG for standalone HTML) ---
        const IconBase = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Shield = ({ className }) => (
            <IconBase className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></IconBase>
        );
        const ShieldAlert = ({ className }) => (
            <IconBase className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></IconBase>
        );
        const ShieldCheck = ({ className }) => (
            <IconBase className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></IconBase>
        );
        const Search = ({ className }) => (
            <IconBase className={className}><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></IconBase>
        );
        const Server = ({ className }) => (
            <IconBase className={className}><rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/></IconBase>
        );
        const Activity = ({ className }) => (
            <IconBase className={className}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconBase>
        );
        const AlertTriangle = ({ className }) => (
            <IconBase className={className}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></IconBase>
        );
        const FileText = ({ className }) => (
            <IconBase className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></IconBase>
        );
        const RefreshCw = ({ className }) => (
            <IconBase className={className}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>
        );
        const Lock = ({ className }) => (
            <IconBase className={className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>
        );
        const Info = ({ className }) => (
            <IconBase className={className}><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></IconBase>
        );
        const RotateCcw = ({ className }) => (
            <IconBase className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconBase>
        );

        // --- Main App Component ---
        const App = () => {
            const [emailContent, setEmailContent] = useState('');
            const [sender, setSender] = useState('');
            const [status, setStatus] = useState('idle'); // idle, analyzing, verifying, result
            const [progress, setProgress] = useState(0);
            const [dbStatus, setDbStatus] = useState('connecting'); // connecting, connected, error
            const [result, setResult] = useState(null);

            // 模擬啟動時連線至政府資料庫
            useEffect(() => {
                const timer = setTimeout(() => {
                setDbStatus('connected');
                }, 1500);
                return () => clearTimeout(timer);
            }, []);

            const handleAnalyze = () => {
                if (!emailContent.trim()) return;

                setStatus('analyzing');
                setProgress(0);
                setResult(null);

                // 模擬分析流程
                let progressTimer = setInterval(() => {
                setProgress((prev) => {
                    if (prev >= 90) {
                    clearInterval(progressTimer);
                    return 90;
                    }
                    return prev + 10;
                });
                }, 200);

                // 模擬 API 延遲與邏輯
                setTimeout(() => {
                clearInterval(progressTimer);
                setProgress(100);
                setStatus('verifying');
                
                // 模擬與政府資料庫比對
                setTimeout(() => {
                    const analysisResult = analyzeScamLogic(sender, emailContent);
                    setResult(analysisResult);
                    setStatus('result');
                }, 1500);
                }, 2000);
            };

            // 簡單的本地規則邏輯 (模擬後端 AI 與資料庫回傳)
            const analyzeScamLogic = (senderText, contentText) => {
                const suspiciousKeywords = ['匯款', '中獎', '帳戶', '解凍', '緊急', '比特幣', '泰達幣', '安全驗證', '點擊連結', 'ATM', '分期付款', '配合調查'];
                const highRiskDomains = ['gmail.com', 'yahoo.com.tw', 'hotmail.com']; // 針對公務機關信件如果是免費信箱
                
                let score = 0; // 0-100, 越高越危險
                let detectedKeywords = [];
                let reasons = [];

                // 檢查關鍵字
                suspiciousKeywords.forEach(kw => {
                if (contentText.includes(kw)) {
                    score += 15;
                    detectedKeywords.push(kw);
                }
                });

                // 檢查寄件者
                if (senderText) {
                if (highRiskDomains.some(d => senderText.includes(d)) && (contentText.includes('銀行') || contentText.includes('警察') || contentText.includes('法院'))) {
                    score += 30;
                    reasons.push('公務/銀行機構使用免費私人信箱 (極高風險)');
                }
                }

                // 模擬 165 資料庫比對結果
                const isDatabaseMatch = Math.random() > 0.7 || score > 50; 
                
                if (isDatabaseMatch) {
                score += 40;
                reasons.push('寄件來源或內容特徵與 165 反詐騙資料庫紀錄相符');
                }

                if (detectedKeywords.length > 0) {
                reasons.push(`偵測到高風險詐騙關鍵字：${detectedKeywords.join(', ')}`);
                }

                let riskLevel = 'safe';
                if (score > 75) riskLevel = 'danger';
                else if (score > 30) riskLevel = 'warning';

                return {
                score: Math.min(score, 100),
                riskLevel,
                reasons,
                matchId: isDatabaseMatch ? `CASE-${Math.floor(Math.random() * 100000)}` : null
                };
            };

            // 完全重置
            const reset = () => {
                setEmailContent('');
                setSender('');
                setStatus('idle');
                setResult(null);
                setProgress(0);
            };

            // 保留內容並重新分析
            const handleRetry = () => {
                setStatus('idle');
                setResult(null);
                setProgress(0);
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 font-sans">
                {/* Header / Navbar */}
                <header className="bg-blue-900 text-white shadow-lg sticky top-0 z-50">
                    <div className="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
                    <div className="flex items-center space-x-3">
                        <Shield className="w-8 h-8 text-yellow-400" />
                        <div>
                        <h1 className="text-xl font-bold tracking-wide">全民防詐騙守護網</h1>
                        <p className="text-xs text-blue-200">AI 智能分析 x 政府資料庫連線</p>
                        </div>
                    </div>
                    
                    <div className="hidden md:flex items-center bg-blue-800 px-3 py-1.5 rounded-full border border-blue-700">
                        {dbStatus === 'connecting' ? (
                        <>
                            <div className="w-4 h-4 mr-2 animate-spin text-yellow-400">
                                <RefreshCw className="w-full h-full" />
                            </div>
                            <span className="text-sm font-medium">正在連線至 165 資料庫...</span>
                        </>
                        ) : dbStatus === 'connected' ? (
                        <>
                            <span className="relative flex h-3 w-3 mr-2">
                            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                            <span className="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                            </span>
                            <span className="text-sm font-medium text-green-300">已連線至政府防詐雲端</span>
                        </>
                        ) : (
                        <span className="text-sm text-red-300">連線異常</span>
                        )}
                    </div>
                    </div>
                </header>

                {/* Main Content */}
                <main className="max-w-3xl mx-auto px-4 py-8">
                    
                    {/* Connection Alert for Mobile */}
                    <div className="md:hidden mb-4 flex items-center justify-center space-x-2 text-sm text-slate-600 bg-white p-2 rounded-lg shadow-sm">
                    {dbStatus === 'connected' ? (
                        <>
                        <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <span>系統已連線</span>
                        </>
                    ) : (
                        <span>連線中...</span>
                    )}
                    </div>

                    {/* Introduction Card */}
                    {status === 'idle' && (
                    <div className="bg-white rounded-xl shadow-sm p-6 mb-6 border-l-4 border-blue-600">
                        <h2 className="text-lg font-bold text-slate-800 mb-2 flex items-center">
                        <Info className="w-5 h-5 mr-2 text-blue-600" />
                        如何使用本系統？
                        </h2>
                        <p className="text-slate-600 mb-4">
                        請將您收到的可疑郵件內容或寄件者地址貼入下方欄位。系統將進行 AI 語意分析，並即時比對政府反詐騙黑名單資料庫。
                        </p>
                        <div className="flex gap-4 text-sm text-slate-500">
                        <div className="flex items-center"><Lock className="w-4 h-4 mr-1" /> 資料加密傳輸</div>
                        <div className="flex items-center"><Server className="w-4 h-4 mr-1" /> 即時比對資料庫</div>
                        </div>
                    </div>
                    )}

                    {/* Input Section */}
                    <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                    <div className="p-1 bg-slate-100 border-b border-slate-200 flex gap-2 px-4 py-2">
                        <div className="flex space-x-1.5">
                        <div className="w-3 h-3 rounded-full bg-red-400"></div>
                        <div className="w-3 h-3 rounded-full bg-yellow-400"></div>
                        <div className="w-3 h-3 rounded-full bg-green-400"></div>
                        </div>
                    </div>
                    
                    <div className="p-6 space-y-4">
                        <div>
                        <label className="block text-sm font-semibold text-slate-700 mb-1">寄件者 (Email 或 名稱)</label>
                        <input 
                            type="text" 
                            placeholder="例如：service@unknown-bank.com"
                            className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition"
                            value={sender}
                            onChange={(e) => setSender(e.target.value)}
                            disabled={status !== 'idle'}
                        />
                        </div>
                        
                        <div>
                        <label className="block text-sm font-semibold text-slate-700 mb-1">郵件內容</label>
                        <textarea 
                            placeholder="請將郵件內文完整複製貼上於此..."
                            className="w-full h-48 p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition resize-none"
                            value={emailContent}
                            onChange={(e) => setEmailContent(e.target.value)}
                            disabled={status !== 'idle'}
                        ></textarea>
                        </div>

                        {/* Actions / Progress */}
                        <div className="pt-4">
                        {status === 'idle' ? (
                            <div className="flex space-x-3">
                            <button 
                                onClick={handleAnalyze}
                                disabled={!emailContent}
                                className={`flex-1 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center transition transform active:scale-[0.98] ${
                                !emailContent 
                                    ? 'bg-slate-200 text-slate-400 cursor-not-allowed' 
                                    : 'bg-gradient-to-r from-blue-600 to-indigo-700 text-white hover:shadow-blue-500/30'
                                }`}
                            >
                                <Search className="w-5 h-5 mr-2" />
                                開始即時檢測
                            </button>
                            {/* 如果有內容但狀態是 idle，顯示一個清空按鈕方便操作 */}
                            {(emailContent || sender) && (
                                <button 
                                onClick={reset}
                                className="px-4 rounded-xl border-2 border-slate-200 text-slate-500 hover:bg-slate-50 hover:text-slate-700 transition"
                                title="清空內容"
                                >
                                <RotateCcw className="w-5 h-5" />
                                </button>
                            )}
                            </div>
                        ) : status !== 'result' ? (
                            <div className="space-y-3">
                            <div className="flex justify-between text-sm font-medium text-slate-600">
                                <span className="flex items-center">
                                {status === 'analyzing' ? '正在分析文本特徵...' : '正在連線政府資料庫比對...'}
                                </span>
                                <span>{progress}%</span>
                            </div>
                            <div className="w-full bg-slate-200 rounded-full h-2.5 overflow-hidden">
                                <div 
                                className="bg-blue-600 h-2.5 rounded-full transition-all duration-300 ease-out" 
                                style={{ width: `${progress}%` }}
                                ></div>
                            </div>
                            {status === 'verifying' && (
                                <div className="flex items-center justify-center text-xs text-blue-600 animate-pulse">
                                <Server className="w-3 h-3 mr-1" />
                                加密連線至 API 165.gov.tw/query (模擬)
                                </div>
                            )}
                            </div>
                        ) : (
                            <div className="flex flex-col sm:flex-row gap-3">
                            <button 
                                onClick={handleRetry}
                                className="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition flex items-center justify-center shadow-md hover:shadow-lg"
                            >
                                <RefreshCw className="w-5 h-5 mr-2" />
                                重新檢測 / 修改
                            </button>
                            <button 
                                onClick={reset}
                                className="flex-1 py-3 bg-white border-2 border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition flex items-center justify-center hover:border-slate-300"
                            >
                                <RotateCcw className="w-5 h-5 mr-2" />
                                清空重置
                            </button>
                            </div>
                        )}
                        </div>
                    </div>
                    </div>

                    {/* Result Section */}
                    {status === 'result' && result && (
                    <div className="mt-8 animate-fade-in-up">
                        <div className={`rounded-2xl shadow-xl overflow-hidden border-2 ${
                        result.riskLevel === 'danger' ? 'border-red-500 bg-red-50' : 
                        result.riskLevel === 'warning' ? 'border-orange-400 bg-orange-50' : 
                        'border-green-500 bg-green-50'
                        }`}>
                        {/* Result Header */}
                        <div className={`p-6 text-white flex items-center justify-between ${
                            result.riskLevel === 'danger' ? 'bg-red-600' : 
                            result.riskLevel === 'warning' ? 'bg-orange-500' : 
                            'bg-green-600'
                        }`}>
                            <div className="flex items-center space-x-4">
                            <div className="p-3 bg-white/20 rounded-full backdrop-blur-sm">
                                {result.riskLevel === 'danger' ? <ShieldAlert className="w-10 h-10" /> : 
                                result.riskLevel === 'warning' ? <AlertTriangle className="w-10 h-10" /> : 
                                <ShieldCheck className="w-10 h-10" />}
                            </div>
                            <div>
                                <h2 className="text-2xl font-bold">
                                {result.riskLevel === 'danger' ? '警告：極高風險詐騙' : 
                                result.riskLevel === 'warning' ? '注意：疑似詐騙郵件' : 
                                '通過：未發現明顯異常'}
                                </h2>
                                <p className="opacity-90">風險指數: {result.score}/100</p>
                            </div>
                            </div>
                            {result.matchId && (
                            <div className="hidden sm:block text-right">
                                <div className="text-xs opacity-75">資料庫比對編號</div>
                                <div className="font-mono font-bold">{result.matchId}</div>
                            </div>
                            )}
                        </div>

                        {/* Analysis Details */}
                        <div className="p-6">
                            <h3 className="text-slate-800 font-bold text-lg mb-4 flex items-center">
                            <Activity className="w-5 h-5 mr-2" />
                            分析報告摘要
                            </h3>
                            
                            {result.reasons.length > 0 ? (
                            <ul className="space-y-3 mb-6">
                                {result.reasons.map((reason, idx) => (
                                <li key={idx} className="flex items-start bg-white p-3 rounded-lg shadow-sm border border-slate-100">
                                    <AlertTriangle className={`w-5 h-5 mr-3 flex-shrink-0 mt-0.5 ${
                                    result.riskLevel === 'danger' ? 'text-red-500' : 'text-orange-500'
                                    }`} />
                                    <span className="text-slate-700 font-medium">{reason}</span>
                                </li>
                                ))}
                            </ul>
                            ) : (
                            <div className="p-4 bg-white rounded-lg border border-green-200 text-green-700 flex items-center mb-6">
                                <ShieldCheck className="w-5 h-5 mr-2" />
                                內容未包含常見詐騙關鍵字，且網域信譽良好。
                            </div>
                            )}

                            <div className="border-t border-slate-200 pt-6">
                            <h4 className="text-sm font-bold text-slate-500 uppercase tracking-wider mb-3">建議處置措施</h4>
                            <div className="grid md:grid-cols-2 gap-4">
                                {result.riskLevel === 'danger' ? (
                                <>
                                    <div className="bg-white p-4 rounded-lg border-l-4 border-red-500 shadow-sm">
                                    <strong className="block text-red-600 mb-1">絕對不要點擊連結</strong>
                                    <span className="text-sm text-slate-600">郵件內的連結可能含有惡意程式或釣魚網頁。</span>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg border-l-4 border-red-500 shadow-sm">
                                    <strong className="block text-red-600 mb-1">不要匯款或提供個資</strong>
                                    <span className="text-sm text-slate-600">政府機關不會透過 Email 要求操作 ATM 或提供帳戶密碼。</span>
                                    </div>
                                </>
                                ) : (
                                <div className="bg-white p-4 rounded-lg border-l-4 border-blue-500 shadow-sm col-span-2">
                                    <strong className="block text-blue-600 mb-1">保持警覺</strong>
                                    <span className="text-sm text-slate-600">即使系統判定安全，涉及金錢往來仍建議直接致電官方機構確認。</span>
                                </div>
                                )}
                            </div>
                            </div>

                            <div className="mt-6 flex justify-end">
                            <button className="text-sm text-slate-400 hover:text-slate-600 flex items-center">
                                <FileText className="w-4 h-4 mr-1" />
                                下載完整分析報告
                            </button>
                            </div>
                        </div>
                        </div>
                        
                        <div className="mt-4 text-center">
                        <p className="text-sm text-slate-500">
                            遇到可疑狀況，請直接撥打 <span className="font-bold text-blue-600">165</span> 反詐騙專線查證
                        </p>
                        </div>
                    </div>
                    )}
                    
                    <footer className="mt-12 text-center text-slate-400 text-xs py-4">
                    <p>© 2025 全民防詐騙守護網 Prototype | 本系統僅供展示，實際資料庫需經授權存取</p>
                    </footer>
                </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
